<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ETIHAD — Минималистичный кабинет</title>
<style>
  /* Стильный минимализм + фон */
  :root{--accent:#2a62f5;--card:#ffffff;--muted:#6b7280}
  html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:#f2f5f9}
  body{
    background-image: linear-gradient(180deg, rgba(14,42,75,0.06), rgba(255,255,255,0.2)), url('https://images.unsplash.com/photo-1523950403804-5cbd2cc1e9b5?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=96c9b5b8f2c3cc9f6f4a8d1b8b1c2e2c');
    background-size:cover;background-position:center;
    display:flex;align-items:center;justify-content:center;padding:24px;box-sizing:border-box;
  }

  .frame{width:100%;max-width:720px;background:rgba(255,255,255,0.92);border-radius:14px;box-shadow:0 18px 40px rgba(6,20,40,0.18);padding:24px;backdrop-filter: blur(4px);}
  .brand{display:flex;align-items:center;gap:12px;margin-bottom:6px}
  .logo{width:56px;height:56px;border-radius:10px;background:var(--card);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);box-shadow:0 8px 18px rgba(10,20,40,0.08)}
  h1{margin:0;font-size:18px;color:#0b1220}
  .small{color:var(--muted);font-size:13px;margin-top:4px}

  /* Login */
  .login{display:grid;gap:10px;margin-top:18px}
  input{padding:12px;border-radius:10px;border:1px solid #e7ecf6;font-size:15px}
  .row{display:flex;gap:8px}
  button{background:var(--accent);color:#fff;padding:12px;border-radius:10px;border:0;font-weight:700;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid #e6e9ef;color:#111;padding:10px;border-radius:10px;cursor:pointer}

  /* Dashboard */
  .card{margin-top:16px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);box-shadow:0 8px 20px rgba(6,18,36,0.06)}
  .center{text-align:center}
  .menu-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:12px}
  .menu-item{padding:12px;border-radius:10px;background:#ffffff;border:1px solid #eef3ff;cursor:pointer;text-align:center;font-weight:600}
  .menu-item .cat{font-size:12px;color:var(--muted);font-weight:500;margin-top:6px}
  .manager-box{display:flex;align-items:center;gap:10px;margin-top:12px}
  .manager-box select{padding:10px;border-radius:10px;border:1px solid #e6e9ef}
  .start-btn{display:inline-block;padding:14px 28px;border-radius:12px;background:linear-gradient(90deg,var(--accent),#4b7bff);color:white;font-size:16px;border:0;cursor:pointer;font-weight:800}
  .timer{margin-left:12px;color:var(--muted);font-weight:600}
  @media(max-width:520px){.row{flex-direction:column}.frame{padding:16px}}
</style>
</head>
<body>
  <div class="frame" id="app">
    <div class="brand">
      <div class="logo">ET</div>
      <div>
        <h1>ETIHAD — Кабинет сотрудника</h1>
        <div class="small">Вход через логин/пароль — персональные кабинеты</div>
      </div>
    </div>

    <!-- LOGIN -->
    <div id="loginView" class="card">
      <div style="font-weight:700">Войти в кабинет</div>
      <div class="small">Введите логин и пароль вашего аккаунта</div>
      <div class="login">
        <input id="loginInput" placeholder="Логин (напр. odina)" autocomplete="username" />
        <input id="passInput" type="password" placeholder="Пароль" autocomplete="current-password" />
        <div class="row">
          <button id="loginBtn">Войти</button>
          <button id="demoBtn" class="btn-ghost">Войти как Одина (демо)</button>
        </div>
        <div id="loginError" class="small" style="color:#c53030;display:none"></div>
      </div>
    </div>

    <!-- DASHBOARD (скрыт пока не залогинен) -->
    <div id="dashView" style="display:none">
      <div class="card center" id="baristaCard">
        <div style="font-weight:800;font-size:18px" id="baristaName">Одина</div>
        <div class="small" style="margin-top:6px">Кабинет обслуживания</div>

        <!-- Менеджер -->
        <div class="manager-box">
          <div style="font-size:14px;font-weight:600">Менеджер у клиента:</div>
          <select id="managerSelect" aria-label="Выбрать менеджера"></select>
          <div id="sessionTimer" class="timer"></div>
        </div>

        <!-- Меню -->
        <div class="menu-grid" id="menuGrid" aria-label="Меню бара"></div>

        <!-- Кнопка старт (одна кнопка, переключается на Завершить) -->
        <div style="margin-top:16px" id="startWrap" class="center">
          <button id="startBtn" class="start-btn">Старт</button>
        </div>
      </div>
    </div>

  </div>

<script>
// Простое приложение: логин/пароль -> бариста view (Одина)
const STORAGE_KEY = 'etihad_min_user_v1';

// Данные: пользователи с логином/паролем
const DEFAULT = {
  users: [
    {id:'od1', login:'odina', password:'1234', name:'Одина', role:'barista'},
    {id:'m1', login:'samir', password:'0000', name:'Самир', role:'manager'},
    // можно добавить ещё менеджеров здесь
  ],
  menu: [
    {id:'m1', title:'Чёрный чай', cat:'Чай'},
    {id:'m2', title:'Зелёный чай', cat:'Чай'},
    {id:'m3', title:'Эспрессо', cat:'Кофе'},
    {id:'m4', title:'Капучино', cat:'Кофе'},
    {id:'m5', title:'Апельсиновый сок', cat:'Соки'}
  ],
  sessions: []
};

function load(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) { localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT)); return JSON.parse(JSON.stringify(DEFAULT)); }
    return JSON.parse(raw);
  } catch(e){ return JSON.parse(JSON.stringify(DEFAULT)); }
}
function save(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }

let state = load();
let currentUser = null;
let activeSession = null;
let timerInterval = null;

// UI refs
const loginView = document.getElementById('loginView');
const dashView = document.getElementById('dashView');
const loginBtn = document.getElementById('loginBtn');
const demoBtn = document.getElementById('demoBtn');
const loginInput = document.getElementById('loginInput');
const passInput = document.getElementById('passInput');
const loginError = document.getElementById('loginError');

const baristaName = document.getElementById('baristaName');
const managerSelect = document.getElementById('managerSelect');
const menuGrid = document.getElementById('menuGrid');
const startBtn = document.getElementById('startBtn');
const sessionTimer = document.getElementById('sessionTimer');

// fill manager select (only users with role manager)
function renderManagers(){
  managerSelect.innerHTML = '';
  const managers = state.users.filter(u=>u.role==='manager' || u.role==='director' || u.role==='operator');
  if(managers.length===0){
    const opt = document.createElement('option'); opt.value=''; opt.textContent='— нет менеджеров —'; managerSelect.appendChild(opt); return;
  }
  managers.forEach(m=>{
    const opt = document.createElement('option'); opt.value = m.id; opt.textContent = m.name; managerSelect.appendChild(opt);
  });
}

// render menu (simple)
function renderMenu(){
  menuGrid.innerHTML = '';
  state.menu.forEach(it=>{
    const el = document.createElement('div'); el.className='menu-item'; el.dataset.id = it.id;
    el.innerHTML = `<div>${it.title}</div><div class="cat">${it.cat}</div>`;
    menuGrid.appendChild(el);
  });
}

// login logic
loginBtn.addEventListener('click', ()=>{
  const login = loginInput.value.trim();
  const pass = passInput.value;
  if(!login || !pass){ showError('Введите логин и пароль'); return; }
  const u = state.users.find(x=>x.login===login && x.password===pass);
  if(!u){ showError('Неверный логин или пароль'); return; }
  loginError.style.display='none';
  enterAs(u);
});

demoBtn.addEventListener('click', ()=>{ // быстро войти как Одина
  const u = state.users.find(x=>x.login==='odina');
  if(u) enterAs(u);
});

function showError(text){
  loginError.style.display = 'block';
  loginError.textContent = text;
}

// enter
function enterAs(u){
  currentUser = u;
  // only allow barista to see the minimal view — others blocked for now (or show message)
  if(u.role !== 'barista'){
    alert('Этот прототип предназначен для кабинета кофеледи. Войдите как Одина (barista) для теста.');
    return;
  }
  loginView.style.display='none';
  dashView.style.display='block';
  baristaName.textContent = u.name;
  renderManagers();
  renderMenu();
  resetSessionUI();
}

// Session timer helpers
function formatDur(sec){
  const m = Math.floor(sec/60); const s = sec%60; return `${m}м ${s}с`;
}
function startTimer(session){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    if(!session) return;
    const sec = Math.round((Date.now()-session.started)/1000);
    sessionTimer.textContent = `Время: ${formatDur(sec)}`;
  }, 500);
}
function stopTimer(){
  if(timerInterval) { clearInterval(timerInterval); timerInterval = null; sessionTimer.textContent=''; }
}

// Start / Finish toggle
startBtn.addEventListener('click', ()=>{
  if(!activeSession){
    // start new session
    activeSession = {
      sid: 's'+Date.now(),
      userId: currentUser.id,
      started: Date.now(),
      managerId: managerSelect.value || null,
      items: []
    };
    state.sessions.push(activeSession);
    save(state);
    startBtn.textContent = 'Завершить';
    startBtn.style.background = '#c43030'; // красный для завершить
    startTimer(activeSession);
    // allow clicking menu to add items
    menuGrid.classList.add('active');
  } else {
    // finish session
    activeSession.ended = Date.now();
    activeSession.duration = Math.round((activeSession.ended - activeSession.started)/1000);
    // show simple alert with time (можно заменить другим UI)
    alert('Сессия завершена. Время: ' + formatDur(activeSession.duration));
    save(state);
    activeSession = null;
    startBtn.textContent = 'Старт';
    startBtn.style.background = '';
    stopTimer();
    menuGrid.classList.remove('active');
    sessionTimer.textContent = '';
  }
});

// clicking menu items to add to active session (if active)
menuGrid.addEventListener('click', (ev)=>{
  if(!activeSession) { /* do nothing, minimal requirement — show menu only */ return; }
  const item = ev.target.closest('.menu-item');
  if(!item) return;
  const id = item.dataset.id;
  const it = state.menu.find(m=>m.id===id);
  if(!it) return;
  activeSession.items.push({title: it.title, at: Date.now()});
  save(state);
  // small visual feedback
  item.style.transform = 'scale(0.98)';
  setTimeout(()=> item.style.transform = '', 120);
});

// reset UI when showing dashboard
function resetSessionUI(){
  activeSession = null;
  stopTimer();
  startBtn.textContent = 'Старт';
  startBtn.style.background = '';
  sessionTimer.textContent = '';
}

// On load: focus login
loginInput.focus();
</script>
</body>
</html>
